name: Notify on Main Merge

on:
  push:
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, '[notify]') || contains(github.event.head_commit.body, '[notify]')
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      
      - name: Install dependencies
        run: npm install nodemailer
      
      - name: Send deployment notification
        run: node scripts/send-email.js
        env:
          EMAIL_LIST: ${{ secrets.EMAIL_LIST }}
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_ACTOR: ${{ github.actor }}
          GITHUB_SHA: ${{ github.sha }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          COMMIT_DESCRIPTION: ${{ github.event.head_commit.body }}
          IS_MERGE: ${{ github.event.head_commit.committer.name == 'GitHub' }}
